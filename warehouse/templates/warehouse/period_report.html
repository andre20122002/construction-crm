{% extends 'warehouse/base.html' %}

{% block title %}–û–±–æ—Ä–æ—Ç–Ω–∞ –≤—ñ–¥–æ–º—ñ—Å—Ç—å{% endblock %}

{% block content %}
<div class="container-fluid">
    <h3 class="mb-4">üìÖ –û–±–æ—Ä–æ—Ç–Ω–∞ –≤—ñ–¥–æ–º—ñ—Å—Ç—å –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤</h3>

    <!-- –§—ñ–ª—å—Ç—Ä -->
    <div class="card shadow-sm mb-4 no-print">
        <div class="card-body bg-light">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-md-3">
                    {{ form.start_date.label_tag }}
                    {{ form.start_date }}
                </div>
                <div class="col-md-3">
                    {{ form.end_date.label_tag }}
                    {{ form.end_date }}
                </div>
                <div class="col-md-3">
                    {{ form.warehouse.label_tag }}
                    {{ form.warehouse }}
                </div>
                <div class="col-md-3 d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏
                    </button>
                    <button type="submit" name="export" value="excel" class="btn btn-success" title="–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel">
                        <i class="bi bi-file-earmark-excel"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
    {% if results %}
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0">
            <h5 class="mb-0">
                –ó–≤—ñ—Ç {% if warehouse %}–ø–æ —Å–∫–ª–∞–¥—É: <b>{{ warehouse.name }}</b>{% else %}–ø–æ –≤—Å—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó{% endif %}
                <small class="text-muted fs-6 ms-2">({{ request.GET.start_date }} ‚Äî {{ request.GET.end_date }})</small>
            </h5>
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-hover align-middle table-sm">
                <thead class="table-dark">
                    <tr>
                        <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th> <!-- –ù–û–í–ê –ö–û–õ–û–ù–ö–ê -->
                        <th>–ú–∞—Ç–µ—Ä—ñ–∞–ª</th>
                        <th class="text-center">–û–¥.</th>
                        <th class="text-end bg-secondary bg-opacity-25">–ü–æ—á–∞—Ç–æ–∫</th>
                        <th class="text-end text-success">+ –ü—Ä–∏—Ö—ñ–¥</th>
                        <th class="text-end text-danger">- –í–∏—Ç—Ä–∞—Ç–∞</th>
                        <th class="text-end bg-primary bg-opacity-25">–ö—ñ–Ω–µ—Ü—å</th>
                        <th class="text-end">–°—É–º–∞ (–≥—Ä–Ω)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in results %}
                    <tr>
                        <!-- –í–∏–≤–æ–¥–∏–º–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é —Å—ñ—Ä–∏–º –∫–æ–ª—å–æ—Ä–æ–º -->
                        <td class="text-muted small fw-bold">{{ row.category }}</td>
                        
                        <td class="fw-bold">{{ row.material.name }}</td>
                        <td class="text-center small">{{ row.material.unit }}</td>
                        
                        <!-- –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –∑–∞–ª–∏—à–æ–∫ -->
                        <td class="text-end border-end bg-light">{{ row.start_balance }}</td>
                        
                        <!-- –û–±–æ—Ä–æ—Ç–∏ -->
                        <td class="text-end text-success opacity-75">
                            {% if row.income > 0 %}+{{ row.income }}{% else %}-{% endif %}
                        </td>
                        <td class="text-end text-danger opacity-75 border-end">
                            {% if row.outcome > 0 %}-{{ row.outcome }}{% else %}-{% endif %}
                        </td>
                        
                        <!-- –ö—ñ–Ω—Ü–µ–≤–∏–π –∑–∞–ª–∏—à–æ–∫ -->
                        <td class="text-end fw-bold bg-light text-primary border-end">{{ row.end_balance }}</td>
                        
                        <td class="text-end small">{{ row.total_value }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
        <div class="alert alert-info text-center mt-4">
            –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏", —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –¥–∞–Ω—ñ –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π –ø–µ—Ä—ñ–æ–¥.
        </div>
    {% endif %}
</div>
{% endblock %}