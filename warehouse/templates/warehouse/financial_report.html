{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç{% endblock %}

{% block content %}
<div class="container-fluid">
    <h3 class="mb-4 fw-bold"><i class="bi bi-pie-chart-fill me-2"></i> –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∑–≤—ñ—Ç</h3>

    <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
    <form method="get" class="card shadow-sm mb-4 border-0 bg-light">
        <div class="card-body row g-2 align-items-end">
            <div class="col-md-3">
                <label class="small text-muted fw-bold">–ü–µ—Ä—ñ–æ–¥ –∑</label>
                <input type="date" name="date_from" class="form-control" value="{{ date_from|default:'' }}">
            </div>
            <div class="col-md-3">
                <label class="small text-muted fw-bold">–ø–æ</label>
                <input type="date" name="date_to" class="form-control" value="{{ date_to|default:'' }}">
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏</button>
            </div>
            <div class="col-md-3 text-end">
                <div class="small text-muted">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏—Ç—Ä–∞—Ç</div>
                <div class="h3 fw-bold text-success mb-0">{{ total_spent }} <small>‚Ç¥</small></div>
            </div>
        </div>
    </form>

    <!-- KPI -->
    <div class="row g-4 mb-4">
        <!-- –ì—Ä–∞—Ñ—ñ–∫ 1: –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 fw-bold">
                    üèóÔ∏è –¢–æ–ø –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ (–í–∏—Ç—Ä–∞—Ç–∏)
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="suppliersChart"></canvas>
                        <div class="text-muted small mt-2 d-none text-center" data-empty-msg="sup">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø–æ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞—Ö</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ì—Ä–∞—Ñ—ñ–∫ 2: –î–∏–Ω–∞–º—ñ–∫–∞ -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 fw-bold">
                    üìÖ –î–∏–Ω–∞–º—ñ–∫–∞ –≤–∏—Ç—Ä–∞—Ç –ø–æ –¥–Ω—è—Ö
                </div>
                <div class="card-body">
                    <div style="height: 300px; position: relative;">
                        <canvas id="trendChart"></canvas>
                        <div class="text-muted small mt-2 d-none text-center" data-empty-msg="trend">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –∑–∞ –ø–µ—Ä—ñ–æ–¥</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JSON DATA FOR CHARTS -->
{{ sup_labels|json_script:"sup-labels" }}
{{ sup_data|json_script:"sup-data" }}
{{ date_labels|json_script:"date-labels" }}
{{ date_values|json_script:"date-values" }}

{% endblock %}

{% block extra_js %}
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–∏–π Chart.js (vendor) -->
<script src="{% static 'vendor/chartjs/chart.umd.min.js' %}"></script>

<!-- –õ–æ–≥—ñ–∫–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ -->
<script src="{% static 'warehouse/js/financial_charts.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.FinancialCharts) {
            window.FinancialCharts.init();
        }
    });
</script>
{% endblock %}