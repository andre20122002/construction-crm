{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}–ü—Ä–∏–π–æ–º –ø–æ—Å—Ç–∞–≤–∫–∏{% endblock %}

{% block extra_css %}
<style>
    /* –ì–ª–∏–±–æ–∫–∏–π —Ç–µ–º–Ω–∏–π —Ñ–æ–Ω —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º—É –ø—Ä–æ—Ä–∞–±–∞ */
    body { background-color: #121212; color: #e0e0e0; } 
    
    /* –ö–∞—Ä—Ç–∫–∞ —Ç—Ä–æ—Ö–∏ —Å–≤—ñ—Ç–ª—ñ—à–∞, —â–æ–± –≤–∏–¥—ñ–ª—è—Ç–∏—Å—è */
    .card { 
        background-color: #1e1e1e; 
        border: 1px solid #333; 
        color: #fff; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    .form-control { 
        background-color: #2c2c2c; 
        border-color: #444; 
        color: #fff; 
    }
    .form-control:focus { 
        background-color: #333; 
        color: #fff; 
        border-color: #0d6efd; 
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    
    /* –Ø—Å–∫—Ä–∞–≤—ñ –ª–µ–π–±–ª–∏ –∑–∞–º—ñ—Å—Ç—å —Ç—å–º—è–Ω–∏—Ö */
    .text-label { 
        color: #a0a0a0 !important; /* –°–≤—ñ—Ç–ª–æ-—Å—ñ—Ä–∏–π */
    }

    /* –°—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏-–∫–∞–º–µ—Ä–∏ */
    .btn-camera {
        width: 100%;
        padding: 20px;
        border: 2px dashed #444;
        border-radius: 10px;
        background: #2c2c2c;
        color: #aaa;
        cursor: pointer;
        transition: all 0.2s;
        text-align: center;
        display: block;
    }
    .btn-camera:hover {
        background: #333;
        color: #fff;
    }
    .btn-camera.active {
        border-color: #198754;
        color: #198754;
        background: #1e3a2a;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-3 pb-5" style="max-width: 800px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="h4 fw-bold"><i class="bi bi-box-seam me-2"></i> –ü—Ä–∏–π–æ–º –ø–æ—Å—Ç–∞–≤–∫–∏</h3>
        <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">–ù–∞–∑–∞–¥</a>
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- –û—Å–Ω–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∫–∞ -->
        <div class="card mb-4">
            <div class="card-header border-bottom border-secondary py-3">
                <h5 class="mb-0 fw-bold">–ó–∞—è–≤–∫–∞ #{{ order.id }}</h5>
                <small class="text-muted">{{ order.warehouse.name }}</small>
            </div>
            <div class="card-body">
                
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle mb-0">
                        <thead>
                            <tr>
                                <th>–ú–∞—Ç–µ—Ä—ñ–∞–ª</th>
                                <th class="text-center" style="width: 120px;">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.items.all %}
                            <tr>
                                <td>
                                    <div class="fw-bold">{{ item.material.name }}</div>
                                    <small class="text-muted">{{ item.material.unit }}</small>
                                </td>
                                <td>
                                    <input type="number" 
                                           name="item_qty_{{ item.id }}" 
                                           class="form-control text-center fw-bold" 
                                           step="0.001" 
                                           value="{{ item.quantity|floatformat:3 }}" 
                                           required>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- –§–æ—Ç–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è -->
        <div class="card mb-4">
            <div class="card-body">
                <label class="form-label fw-bold text-label mb-3">üì∏ –§–æ—Ç–æ –Ω–∞–∫–ª–∞–¥–Ω–æ—ó –∞–±–æ —Ç–æ–≤–∞—Ä—É</label>
                
                <label class="btn-camera" id="cameraLabel">
                    <input type="file" name="proof_photo" id="cameraInput" accept="image/*" capture="environment" hidden>
                    <i class="bi bi-camera-fill fs-1 d-block mb-2"></i>
                    <span id="cameraText">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ</span>
                </label>

                <div id="previewContainer" class="mt-3 text-center" style="display: none;">
                    <img id="previewImg" src="" class="img-fluid rounded border border-secondary" style="max-height: 300px;">
                </div>
            </div>
        </div>

        <!-- –ö–æ–º–µ–Ω—Ç–∞—Ä —ñ –î—ñ—ó -->
        <div class="card mb-5">
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label text-label">–ö–æ–º–µ–Ω—Ç–∞—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
                    <textarea name="comment" class="form-control" rows="2" placeholder="–ù–æ–º–µ—Ä –Ω–∞–∫–ª–∞–¥–Ω–æ—ó, –∑–∞—É–≤–∞–∂–µ–Ω–Ω—è..."></textarea>
                </div>

                <div class="form-check form-switch mb-4">
                    <input class="form-check-input" type="checkbox" id="actReject">
                    <label class="form-check-label text-danger fw-bold" for="actReject">–¶–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è / –≤—ñ–¥–º–æ–≤–∞?</label>
                </div>

                <div id="block-reject" class="alert alert-danger border-danger mb-4" style="display: none; background-color: #2c0b0e; color: #ea868f;">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> 
                    –¢–æ–≤–∞—Ä –Ω–µ –±—É–¥–µ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ –Ω–∞ –±–∞–ª–∞–Ω—Å. –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∑–º—ñ–Ω–∏—Ç—å—Å—è –Ω–∞ "–í—ñ–¥—Ö–∏–ª–µ–Ω–æ".
                </div>

                <div class="d-grid">
                    <button type="submit" id="mainSubmitBtn" class="btn btn-success btn-lg py-3 fw-bold shadow">
                        <i class="bi bi-box-seam me-2"></i> –û–ü–†–ò–ë–£–¢–ö–£–í–ê–¢–ò
                    </button>
                </div>
            </div>
        </div>

    </form>
</div>
{% endblock %}

{% block extra_js %}
<!-- –õ–æ–≥—ñ–∫–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–≤–∏–Ω–µ—Å–µ–Ω–∞) -->
<script src="{% static 'warehouse/js/confirm_receipt.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.ConfirmReceipt) {
            window.ConfirmReceipt.init();
        }
    });
</script>
{% endblock %}