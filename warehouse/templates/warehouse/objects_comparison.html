{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤{% endblock %}

{% block content %}
<div class="container-fluid">
    <h3 class="mb-4 fw-bold"><i class="bi bi-buildings-fill me-2"></i> –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ (–ë—é–¥–∂–µ—Ç–∏)</h3>

    <!-- –ì–†–ê–§–Ü–ö -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-header bg-white border-0 fw-bold">
            üìä –ë—é–¥–∂–µ—Ç vs –§–∞–∫—Ç–∏—á–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏
        </div>
        <div class="card-body">
            <div style="height: 400px; position: relative;">
                <canvas id="comparisonChart"></canvas>
                <div class="text-center text-muted small d-none mt-5" data-empty-msg="comparison">
                    –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–ê–ë–õ–ò–¶–Ø -->
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
            <span class="fw-bold">–î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ –æ–±'—î–∫—Ç–∞—Ö</span>
            <button onclick="window.print()" class="btn btn-sm btn-outline-secondary no-print"><i class="bi bi-printer"></i> –î—Ä—É–∫</button>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
                <thead class="bg-dark text-white">
                    <tr>
                        <th class="text-start ps-4">–û–±'—î–∫—Ç</th>
                        <th>–ë—é–¥–∂–µ—Ç</th>
                        <th>–í–∏—Ç—Ä–∞—á–µ–Ω–æ</th>
                        <th>% –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</th>
                        <th class="text-end pe-4">–ó–∞–ª–∏—à–æ–∫</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in data %}
                    <tr>
                        <td class="text-start ps-4 fw-bold">{{ row.name }}</td>
                        <td>{{ row.budget|floatformat:2 }} ‚Ç¥</td>
                        <td class="fw-bold text-danger">{{ row.spent|floatformat:2 }} ‚Ç¥</td>
                        <td>
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="progress flex-grow-1 me-2" style="height: 6px; max-width: 100px;">
                                    <div class="progress-bar {% if row.percent > 100 %}bg-danger{% elif row.percent > 80 %}bg-warning{% else %}bg-success{% endif %}" 
                                         role="progressbar" 
                                         style="width: {{ row.percent }}%">
                                    </div>
                                </div>
                                <small class="fw-bold">{{ row.percent|floatformat:0 }}%</small>
                            </div>
                        </td>
                        <td class="text-end pe-4 fw-bold text-success">
                            {{ row.diff|floatformat:2 }} ‚Ç¥
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-4 text-muted">–°–∫–ª–∞–¥–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –∞–±–æ —É –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- DATA FOR CHARTS -->
{{ data|json_script:"comparison-data" }}

{% endblock %}

{% block extra_js %}
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–∫–∞–ª—å–Ω–∏–π Chart.js (vendor) -->
<script src="{% static 'vendor/chartjs/chart.umd.min.js' %}"></script>

<!-- –õ–æ–≥—ñ–∫–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤ -->
<script src="{% static 'warehouse/js/objects_comparison_charts.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (window.ObjectsComparisonCharts) {
            window.ObjectsComparisonCharts.init();
        }
    });
</script>
{% endblock %}