{% extends "warehouse/base.html" %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="h4 mb-3">{{ page_title }}</h2>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-white bg-primary h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-file-earmark-plus me-2"></i>–ù–æ–≤—ñ –∑–∞—è–≤–∫–∏</h5>
                    <p class="card-text display-6 fw-bold">{{ stats.new }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-white bg-success h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title"><i class="bi bi-check-circle me-2"></i>–ü–æ–≥–æ–¥–∂–µ–Ω–æ</h5>
                    <p class="card-text display-6 fw-bold">{{ stats.approved }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-white bg-warning h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-dark"><i class="bi bi-cart me-2"></i>–ó–∞–∫—É–ø—ñ–≤–ª—è</h5>
                    <p class="card-text display-6 fw-bold text-dark">{{ stats.purchasing }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card text-white bg-info h-100 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-dark"><i class="bi bi-truck me-2"></i>–í –¥–æ—Ä–æ–∑—ñ</h5>
                    <p class="card-text display-6 fw-bold text-dark">{{ stats.transit }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white border-0 fw-bold">
                    ‚ö° –®–≤–∏–¥–∫—ñ –¥—ñ—ó
                </div>
                <div class="card-body d-flex flex-wrap gap-2">
                    <a href="{% url 'create_order' %}" class="btn btn-outline-primary">
                        <i class="bi bi-plus-lg me-1"></i> –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—è–≤–∫—É
                    </a>
                    <a href="{% url 'manager_dashboard' %}?status=new" class="btn btn-outline-warning">
                        <i class="bi bi-hourglass-split me-1"></i> –ù–∞ –ø–æ–≥–æ–¥–∂–µ–Ω–Ω—è
                    </a>
                    <a href="{% url 'logistics_monitor' %}" class="btn btn-outline-info">
                        <i class="bi bi-truck me-1"></i> –õ–æ–≥—ñ—Å—Ç–∏–∫–∞
                    </a>
                    <a href="{% url 'material_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-box-seam me-1"></i> –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏
                    </a>
                    <a href="{% url 'suppliers_rating' %}" class="btn btn-outline-dark">
                        <i class="bi bi-people me-1"></i> –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Recent Orders Table -->
        <div class="col-lg-8">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                    <span class="fw-bold">üìã –û—Å—Ç–∞–Ω–Ω—ñ –∑–∞—è–≤–∫–∏</span>
                    <a href="{% url 'manager_dashboard' %}" class="btn btn-sm btn-link text-decoration-none">–í—Å—ñ –∑–∞—è–≤–∫–∏ &rarr;</a>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="ps-3">ID</th>
                                <th>–û–±'—î–∫—Ç</th>
                                <th>–ê–≤—Ç–æ—Ä</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–∞—Ç–∞</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in recent_orders %}
                            <tr>
                                <td class="ps-3 fw-bold">#{{ order.id }}</td>
                                <td>{{ order.warehouse.name }}</td>
                                <td>
                                    <small class="text-muted">{{ order.created_by.get_full_name|default:order.created_by.username }}</small>
                                </td>
                                <td>
                                    {% if order.status == 'new' %}
                                        <span class="badge bg-primary">New</span>
                                    {% elif order.status == 'approved' %}
                                        <span class="badge bg-success">Approved</span>
                                    {% elif order.status == 'purchasing' %}
                                        <span class="badge bg-warning text-dark">Purchasing</span>
                                    {% elif order.status == 'transit' %}
                                        <span class="badge bg-info text-dark">Transit</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ order.get_status_display }}</span>
                                    {% endif %}
                                </td>
                                <td class="text-muted small">{{ order.created_at|date:"d.m" }}</td>
                                <td class="text-end pe-3">
                                    <a href="{% url 'manager_order_detail' order.id %}" class="btn btn-sm btn-light border">
                                        <i class="bi bi-eye"></i>
                                    </a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted py-4">–ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞—è–≤–æ–∫</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Critical Stock Alert (Side Panel) -->
        <div class="col-lg-4">
            <div class="card shadow-sm border-0 h-100 border-start border-4 border-danger">
                <div class="card-header bg-white border-0 fw-bold text-danger">
                    ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω—ñ –∑–∞–ª–∏—à–∫–∏
                </div>
                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">
                        {% for material in critical_stock %}
                        <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                            <div>
                                <strong class="text-dark">{{ material.name }}</strong>
                                <br>
                                <small class="text-muted">
                                    –ú—ñ–Ω. –ª—ñ–º—ñ—Ç: <span class="fw-bold text-danger">{{ material.min_limit }} {{ material.unit }}</span>
                                </small>
                            </div>
                            <a href="{% url 'material_list' %}?q={{ material.article }}" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-search"></i>
                            </a>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-muted py-4">
                            <i class="bi bi-check-circle-fill text-success fs-4 d-block mb-2"></i>
                            –í—Å–µ –≤ –Ω–æ—Ä–º—ñ, –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –∑–∞–ª–∏—à–∫—ñ–≤ –Ω–µ–º–∞—î
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="card-footer text-center bg-white border-top-0 pb-3">
                    <a href="{% url 'material_list' %}" class="btn btn-link text-danger text-decoration-none fw-bold">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤—Å—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ &rarr;</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}