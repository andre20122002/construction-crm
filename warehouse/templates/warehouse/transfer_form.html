{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}Нове переміщення{% endblock %}

{% block extra_css %}
<style>
    /* Стилі */
</style>
{% endblock %}

{% block content %}
<div class="container mt-5 mb-5" style="max-width: 650px;">
    <div class="card shadow border-info">
        <div class="card-header bg-info text-white">
            <h3 class="mb-0 fw-bold"><i class="bi bi-arrow-left-right me-2"></i> Переміщення матеріалів</h3>
        </div>
        <div class="card-body p-4">
            
            {% if form.errors %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> Перевірте правильність заповнення форми.
                    {{ form.errors }}
                </div>
            {% endif %}

            <!-- 
                data-stock-validate: активує автоматичну перевірку залишків (stock_ajax.js)
                data-warehouse-select: вказуємо ID поля складу-джерела (source_warehouse), 
                                       оскільки саме з нього списується товар.
                data-hint-target: куди виводити інформацію про залишок
            -->
            <form method="post" 
                  data-stock-validate 
                  data-warehouse-select="#id_source_warehouse" 
                  data-hint-target="#stock-hint">
                {% csrf_token %}
                
                <h5 class="text-info mb-3">1. Логістика</h5>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">Звідки (Джерело)</label>
                        {{ form.source_warehouse }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">Куди (Призначення)</label>
                        {{ form.target_warehouse }}
                    </div>
                </div>

                <h5 class="text-info mb-3">2. Матеріал та Кількість</h5>
                
                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">Матеріал</label>
                    {{ form.material }}
                </div>

                <div class="row g-3 mb-4 align-items-end">
                    <div class="col-md-6">
                        <label class="form-label fw-bold small text-muted">Кількість</label>
                        {{ form.quantity }}
                    </div>
                    <div class="col-md-6">
                        <!-- Підказка залишку (заповнюється через stock_ajax.js) -->
                        <div id="stock-hint" class="form-text text-muted w-100 ps-2" style="display: none;"></div>
                    </div>
                </div>

                <h5 class="text-info mb-3">3. Деталі</h5>
                
                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">Дата операції</label>
                    <input type="date" name="date" class="form-control" value="{% now 'Y-m-d' %}">
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold small text-muted">Коментар</label>
                    {{ form.description }}
                    <div class="form-text">Вкажіть причину переміщення або номер накладної.</div>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-info text-white fw-bold btn-lg shadow-sm">
                        <i class="bi bi-check-circle-fill me-2"></i> Підтвердити переміщення
                    </button>
                    <a href="{% url 'transfer_journal' %}" class="btn btn-light text-muted">Скасувати</a>
                </div>

            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Підключаємо універсальний скрипт перевірки залишків -->
<script src="{% static 'warehouse/js/stock_ajax.js' %}"></script>
{% endblock %}