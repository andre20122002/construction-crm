{% extends 'warehouse/base.html' %}
{% load static %}

{% block title %}–ê–∫—Ç —Å–ø–∏—Å–∞–Ω–Ω—è / –†–æ–±–æ—Ç–∏{% endblock %}

{% block extra_css %}
<style>
    /* –°—Ç–∏–ª—å –¥–ª—è –≤–µ–ª–∏–∫–∏—Ö –ø–µ—Ä–µ–º–∏–∫–∞—á—ñ–≤ */
    .btn-check:checked + .btn-outline-warning {
        background-color: #ffc107; color: #000; font-weight: bold; border-color: #ffc107;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .btn-check:checked + .btn-outline-danger {
        background-color: #dc3545; color: #fff; font-weight: bold; border-color: #dc3545;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .btn-check:checked + .btn-outline-success {
        background-color: #198754; color: #fff; font-weight: bold; border-color: #198754;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    /* –ë–ª–æ–∫ –µ—Ç–∞–ø—ñ–≤ (–ü—Ä–∏—Ö–æ–≤–∞–Ω–∏–π –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º) */
    #construction-details {
        background-color: #f8f9fa;
        border-left: 5px solid #0d6efd;
        display: none; /* JS –ø–æ–∫–∞–∂–µ —Ü–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ */
        transition: all 0.3s ease;
    }
    .form-label { font-weight: 600; color: #555; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5" style="max-width: 800px;">
    
    <div class="card shadow-lg border-0">
        <div class="card-header bg-white pt-4 pb-0 border-0">
            <h3 class="fw-bold mb-1">üìù –ù–æ–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è</h3>
            <p class="text-muted small">–°–ø–∏—Å–∞–Ω–Ω—è –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ –Ω–∞ —Ä–æ–±–æ—Ç–∏ –∞–±–æ —Ñ—ñ–∫—Å–∞—Ü—ñ—è –≤—Ç—Ä–∞—Ç</p>
        </div>
        
        <div class="card-body p-4">
            
            {% if form.errors %}
                <div class="alert alert-danger">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i> –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏.
                    {{ form.errors }}
                </div>
            {% endif %}

            <!-- 
                data-stock-validate: –∞–∫—Ç–∏–≤—É—î stock_ajax.js
                data-hint-target: —Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –≤–∏–≤–æ–¥—É –∑–∞–ª–∏—à–∫—É
                data-stages-url: URL –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –µ—Ç–∞–ø—ñ–≤ (transaction_form.js)
            -->
            <form method="post" enctype="multipart/form-data" id="transactionForm" 
                  data-stock-validate 
                  data-hint-target="#stock-hint"
                  data-stages-url="{% url 'ajax_load_stages' %}">
                {% csrf_token %}
                
                <!-- 1. –¢–ò–ü –¢–†–ê–ù–ó–ê–ö–¶–Ü–á (RADIO BUTTONS) -->
                <div class="mb-4 text-center">
                    <label class="form-label d-block text-start mb-2">–©–æ —Ä–æ–±–∏–º–æ?</label>
                    <div class="btn-group w-100" role="group">
                        
                        <input type="radio" class="btn-check" name="transaction_type" id="type_out" value="OUT" checked>
                        <label class="btn btn-outline-warning py-3" for="type_out">
                            <i class="bi bi-hammer fs-4 d-block mb-1"></i>
                            –ù–∞ —Ä–æ–±–æ—Ç–∏
                        </label>

                        <input type="radio" class="btn-check" name="transaction_type" id="type_loss" value="LOSS">
                        <label class="btn btn-outline-danger py-3" for="type_loss">
                            <i class="bi bi-trash3 fs-4 d-block mb-1"></i>
                            –°–ø–∏—Å–∞–Ω–Ω—è (–ë—ñ–π)
                        </label>
                        
                        <!-- –û–ø—Ü—ñ—è "–ü—Ä–∏—Ö—ñ–¥" –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ –¥–ª—è –∑–≤–∏—á–∞–π–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->
                        {% if user.is_staff or user.is_superuser %}
                        <input type="radio" class="btn-check" name="transaction_type" id="type_in" value="IN">
                        <label class="btn btn-outline-success py-3" for="type_in">
                            <i class="bi bi-box-seam fs-4 d-block mb-1"></i>
                            –ü—Ä–∏—Ö—ñ–¥ (–ö–æ—Ä.)
                        </label>
                        {% endif %}
                    </div>
                </div>

                <!-- 2. –û–°–ù–û–í–ù–Ü –î–ê–ù–Ü -->
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label">–°–∫–ª–∞–¥ / –û–±'—î–∫—Ç</label>
                        {{ form.warehouse }}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü—ñ—ó</label>
                        <input type="date" name="date" class="form-control" value="{% now 'Y-m-d' %}">
                    </div>
                </div>

                <!-- 3. –î–ï–¢–ê–õ–Ü –ë–£–î–Ü–í–ù–ò–¶–¢–í–ê (–¢—ñ–ª—å–∫–∏ –¥–ª—è OUT) -->
                <div id="construction-details" class="p-3 mb-4 rounded">
                    <h6 class="fw-bold text-primary mb-3"><i class="bi bi-bricks me-2"></i> –î–µ—Ç–∞–ª—ñ —Ä–æ–±—ñ—Ç</h6>
                    <div class="mb-3">
                        <label class="form-label">–ï—Ç–∞–ø –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞</label>
                        <!-- –¶–µ–π —Å–µ–ª–µ–∫—Ç –±—É–¥–µ –∑–∞–ø–æ–≤–Ω—é–≤–∞—Ç–∏—Å—å —á–µ—Ä–µ–∑ JS (AJAX) -->
                        <select name="stage" id="id_stage" class="form-select">
                            <option value="">---------</option>
                        </select>
                        <div class="form-text">–û–±–µ—Ä—ñ—Ç—å –µ—Ç–∞–ø, —â–æ–± —Å–ø–∏—Å–∞–Ω–Ω—è –≤—Ä–∞—Ö—É–≤–∞–ª–æ—Å—å —É –ø–ª–∞–Ω-—Ñ–∞–∫—Ç.</div>
                    </div>
                </div>

                <!-- 4. –ú–ê–¢–ï–†–Ü–ê–õ -->
                <div class="card bg-light border-0 mb-4">
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">–ú–∞—Ç–µ—Ä—ñ–∞–ª</label>
                            <!-- TomSelect –±—É–¥–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ –∫–ª–∞—Å .tom-select -->
                            {{ form.material }}
                        </div>
                        
                        <div class="row">
                            <div class="col-6">
                                <label class="form-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</label>
                                {{ form.quantity }}
                            </div>
                            <div class="col-6 d-flex align-items-end">
                                <!-- –ú—ñ—Å—Ü–µ –¥–ª—è –ø—ñ–¥–∫–∞–∑–∫–∏ –∑–∞–ª–∏—à–∫—É (–Ω–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ stock_ajax.js) -->
                                <div id="stock-hint" class="form-text text-muted w-100 ps-2" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 5. –î–û–î–ê–¢–ö–û–í–û -->
                <div class="mb-3">
                    <label class="form-label">–ö–æ–º–µ–Ω—Ç–∞—Ä / –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è</label>
                    {{ form.description }}
                </div>
                
                <div class="mb-4">
                    <label class="form-label">–§–æ—Ç–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</label>
                    {{ form.photo }}
                </div>

                <!-- –ö–ù–û–ü–ö–ò -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg shadow">
                        <i class="bi bi-check-lg me-2"></i> –ü—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é
                    </button>
                    <a href="javascript:history.back()" class="btn btn-light text-muted">–°–∫–∞—Å—É–≤–∞—Ç–∏</a>
                </div>

            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–∞–ª–∏—à–∫—ñ–≤ -->
<script src="{% static 'warehouse/js/stock_ajax.js' %}"></script>
<!-- –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ –ª–æ–≥—ñ–∫—É —Ñ–æ—Ä–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π (–µ—Ç–∞–ø–∏, –ø–µ—Ä–µ–º–∏–∫–∞—á—ñ) -->
<script src="{% static 'warehouse/js/transaction_form.js' %}"></script>
{% endblock %}